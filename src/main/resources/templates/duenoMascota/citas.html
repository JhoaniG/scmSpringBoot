<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Citas - SCM</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/stilos.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        body { background-color: #f4f6f9; min-height: 100vh; }

        /* Ajuste para la barra lateral */
        .content-wrapper {
            padding-top: 90px;
            padding-bottom: 50px;
            transition: margin-left 0.3s;
        }
        @media (min-width: 992px) {
            .content-wrapper { margin-left: 250px; }
        }

        /* Cabecera de página */
        .page-header {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(111, 66, 193, 0.1);
            text-align: center;
            border-bottom: 4px solid #6f42c1; /* Morado */
        }

        /* Estilos de Tabla (Desktop) */
        .table-custom {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .table-custom thead {
            background-color: #6f42c1;
            color: white;
        }
        .table-custom th { border: none; padding: 15px; font-weight: 600; }
        .table-custom td { padding: 15px; vertical-align: middle; border-bottom: 1px solid #f0f0f0; }
        .table-custom tr:last-child td { border-bottom: none; }
        .table-custom tr:hover { background-color: #f8f9fa; }

        /* Estilos de Tarjetas (Móvil) */
        .appointment-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border-left: 5px solid #6f42c1; /* Borde decorativo */
            transition: transform 0.2s;
        }
        .appointment-card:hover { transform: translateY(-3px); }

        .app-row { display: flex; justify-content: space-between; margin-bottom: 0.5rem; }
        .app-label { color: #888; font-size: 0.9rem; font-weight: 600; }
        .app-value { font-weight: 600; color: #333; text-align: right; }

        /* Estado Vacío */
        .empty-state {
            text-align: center; padding: 4rem 2rem;
            background: white; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        /* Badges */
        .badge-status { padding: 8px 12px; border-radius: 20px; font-weight: 600; font-size: 0.85rem; }
        .status-pendiente { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .status-confirmada { background-color: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; }
        .status-terminada { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; } /* Verde */
        .status-otro { background-color: #e2e3e5; color: #383d41; }
    </style>
</head>
<body>

<div th:replace="fragments/menuV :: menuV"></div>
<input type="checkbox" id="btn-menu">
<div th:replace="~{fragments/barralateralD :: barralateralD(${diagnosticoDTO}, ${mascotas}, ${veterinarios}, ${usuario})}"></div>
<div th:replace="~{fragments/barralateralD :: modalDiagnostico(${diagnosticoDTO}, ${mascotas}, ${veterinarios})}"></div>

<div class="content-wrapper">
    <div class="container">

        <div class="page-header">
            <h2 class="text-primary fw-bold mb-2" style="color: #6f42c1 !important;">
                <i class="fas fa-calendar-check me-2"></i>Mis Citas Médicas
            </h2>
            <p class="text-muted mb-0">Consulta el historial y estado de tus próximas visitas.</p>
        </div>

        <div th:if="${#lists.isEmpty(listaCitas)}" class="empty-state">
            <i class="fas fa-calendar-times fa-4x text-muted mb-3 opacity-50"></i>
            <h3>No tienes citas programadas</h3>
            <p class="text-muted">Puedes solicitar una cita reportando síntomas desde el panel principal.</p>
            <a th:href="@{/dueno/index}" class="btn btn-outline-primary rounded-pill mt-3">Ir al Panel</a>
        </div>

        <div th:unless="${#lists.isEmpty(listaCitas)}">

            <div class="table-responsive d-none d-md-block">
                <table class="table table-custom align-middle">
                    <thead>
                    <tr>
                        <th class="text-center">#</th>
                        <th><i class="fas fa-paw me-2"></i>Mascota</th>
                        <th><i class="fas fa-user-md me-2"></i>Veterinario</th>
                        <th><i class="far fa-clock me-2"></i>Fecha y Hora</th>
                        <th><i class="fas fa-clipboard-list me-2"></i>Motivo</th>
                        <th class="text-center">Estado</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="cita, stat : ${listaCitas}">
                        <td class="text-center text-muted fw-bold" th:text="${stat.index + 1}">1</td>

                        <td>
                            <span class="fw-bold text-dark" th:text="${cita.nombreMascota}">Firulais</span>
                        </td>

                        <td th:text="${cita.nombreVeterinario}">Dr. Perez</td>

                        <td>
                                <span th:if="${cita.fechaCita != null}"
                                      th:text="${#temporals.format(cita.fechaCita, 'dd MMM yyyy - hh:mm a')}">
                                </span>
                        </td>

                        <td th:text="${cita.motivoCita}">Vacunación</td>

                        <td class="text-center">
                            <span class="badge badge-status status-pendiente" th:if="${cita.estadoCita == 'Pendiente'}">Pendiente</span>
                            <span class="badge badge-status status-confirmada" th:if="${cita.estadoCita == 'Confirmada'}">Confirmada</span>
                            <span class="badge badge-status status-terminada" th:if="${cita.estadoCita == 'Terminada'}">Terminada</span>
                            <span class="badge badge-status status-otro"
                                  th:if="${cita.estadoCita != 'Pendiente' and cita.estadoCita != 'Confirmada' and cita.estadoCita != 'Terminada'}"
                                  th:text="${cita.estadoCita}"></span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="d-md-none">
                <div th:each="cita : ${listaCitas}" class="appointment-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="fw-bold m-0 text-primary" th:text="${cita.nombreMascota}">Mascota</h5>
                        <span class="badge badge-status status-pendiente" th:if="${cita.estadoCita == 'Pendiente'}">Pendiente</span>
                        <span class="badge badge-status status-confirmada" th:if="${cita.estadoCita == 'Confirmada'}">Confirmada</span>
                        <span class="badge badge-status status-terminada" th:if="${cita.estadoCita == 'Terminada'}">Terminada</span>
                    </div>

                    <div class="app-row">
                        <span class="app-label"><i class="fas fa-user-md me-1"></i> Vet:</span>
                        <span class="app-value" th:text="${cita.nombreVeterinario}">Nombre</span>
                    </div>
                    <div class="app-row">
                        <span class="app-label"><i class="far fa-calendar-alt me-1"></i> Fecha:</span>
                        <span class="app-value" th:if="${cita.fechaCita != null}"
                              th:text="${#temporals.format(cita.fechaCita, 'dd/MM/yy hh:mm a')}"></span>
                    </div>

                    <hr class="my-2 opacity-25">

                    <div class="mt-2">
                        <span class="app-label d-block mb-1">Motivo:</span>
                        <p class="m-0 text-dark small" th:text="${cita.motivoCita}"></p>
                    </div>
                </div>
            </div>

        </div> <div class="text-center mt-4">
        <a th:href="@{/dueno/index}" class="btn btn-outline-secondary rounded-pill px-4 shadow-sm">
            <i class="fas fa-arrow-left me-2"></i> Volver al Panel
        </a>
    </div>

    </div>
</div>

<footer class="footer mt-auto py-3 bg-light text-center text-muted border-top">
    <div class="container">
        <p class="mb-0">&copy; 2025 SCM - Sistema de Control de Mascotas</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>